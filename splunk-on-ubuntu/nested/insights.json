{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "webTestGuid": {
            "type": "string"
        },
        "webTestRequestGuid": {
            "type": "string"
        },
        "webTestUrlToTest": {
            "type": "string"
        }
    },
    "variables": {
        "insightsApiVersion": "2014-04-01",
        "insightsComponentName": "splunk-insights",
        "insightsComponentLocation": "centralus",
        "insightsWebtestName": "splunk-ping",
        "insightsWebtestFullName": "[concat(variables('insightsComponentName'), '-', variables('insightsWebtestName'))]",
        "webTestName": "[concat('Name=\"', variables('insightsWebtestName'), '\" ')]",
        "webTestGuid": "[concat('Id=\"', parameters('webTestGuid'), '\" ')]",
        "webTestAllElse": "Enabled=\"True\" CssProjectStructure=\"\" CssIteration=\"\" Timeout=\"120\" WorkItemIds=\"\" xmlns=\"http://microsoft.com/schemas/VisualStudio/TeamTest/2010\" Description=\"\" CredentialUserName=\"\" CredentialPassword=\"\" PreAuthenticate=\"True\" Proxy=\"default\" StopOnError=\"False\" RecordedResultFile=\"\" ResultsLocale=\"\"",
        "webTestRequestGuid": "[concat('Guid=\"', parameters('webTestRequestGuid'), '\" ')]",
        "webTestRequestUrl": "[concat('Url=\"', parameters('webTestUrlToTest'), '\" ')]",
        "webTestRequestAllElse": "Method=\"GET\" Version=\"1.1\" ThinkTime=\"0\" Timeout=\"120\" ParseDependentRequests=\"False\" FollowRedirects=\"True\" RecordResult=\"True\" Cache=\"False\" ResponseTimeGoal=\"0\" Encoding=\"utf-8\" ExpectedHttpStatusCode=\"200\" ExpectedResponseUrl=\"\" ReportingName=\"\" IgnoreHttpStatusCode=\"False\" /> ",
        "webTestItems": "[concat('<Items> <Request ', variables('webTestRequestGuid'), variables('webTestRequestUrl'), variables('webTestRequestAllElse'), '</Items> ')]",
        "webTestConfiguration": "[concat('<WebTest ', variables('webTestName'), variables('webTestGuid'), variables('webTestAllElse'), '>', variables('webTestItems'), '</WebTest>')]"
    },
    "resources": [
        {
            "name": "[variables('insightsComponentName')]",
            "type": "Microsoft.Insights/components",
            "apiVersion": "[variables('insightsApiVersion')]",
            "location": "[variables('insightsComponentLocation')]",
            "dependsOn": [],
            "tags": {},
            "properties": {
                "applicationId": "[variables('insightsComponentName')]"
            }
        },
        {
            "name": "[variables('insightsWebTestFullName')]",
            "type": "Microsoft.Insights/webtests",
            "apiVersion": "[variables('insightsApiVersion')]",
            "location": "[variables('insightsComponentLocation')]",
            "dependsOn": [
                "[concat('Microsoft.Insights/components/', variables('insightsComponentName'))]"
            ],
            "tags": {
                "[concat('hidden-link:', resourceId('microsoft.insights/components', variables('insightsComponentName')))]": "Resource"
            },
            "properties": {
                "Name": "[variables('insightsWebtestName')]",
                "Description": "",
                "Enabled": true,
                "Frequency": 300,
                "Timeout": 120,
                "Kind": "ping",
                "RetryEnabled": true,
                "Locations": [
                    {
                        "Id": "us-tx-sn1-azr"
                    },
                    {
                        "Id": "us-il-ch1-azr"
                    },
                    {
                        "Id": "us-ca-sjc-azr"
                    },
                    {
                        "Id": "us-va-ash-azr"
                    },
                    {
                        "Id": "us-fl-mia-edge"
                    }
                ],
                "Configuration": {
                    "WebTest": "[variables('webTestConfiguration')]"
                },
                "SyntheticMonitorId": "[variables('insightsWebTestFullName')]"
            }
        }
    ]
}